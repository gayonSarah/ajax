<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
   
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />

    
  </head>
  <body>

      <div class="caddy pt-2">
          <button class="plus btn btn-primary">+</button>
          <button class="moins btn btn-primary">-</button>
          <input type="text" class="quantity">
        </div>
    <div class="container"></div>  
    <script>
      var cartItemCounter = document.querySelector("span.cart-item-count");
      $.ajax("/products").done(function (data) {
        console.log(data);
        var content;
        var option;
        var qty =0;
        var element =  document.querySelector(".quantity");
        element.value = qty;
        
        $.each(data.products, function (i, item) {
          // console.log(item);
          content +=
            '<div class="card" style="width: 30rem; ">' +
            '<img src="' +
            item.image.src +
            ' class="card-img-top" alt="..." style="width: 17rem;"/>' +
            '<div class="card-body"' +
            ' <h5 class="card-title">' +
            item.title +
            "</h5><br>" +
            +'<p class="card-text text-align-center">' +
            item.body_html +
            ".</p>";
          option = "<div>";
          $.each(item.variants, function (i, item) {
            option +=
            '<button type="bouton" class="btn btn-info m-1" onclick="sendData(' +
              item.id +
              ')">' +        
               item.title +
              "</button>";                            
            });
          option +=
            "</div>" + ' <a href="#" class="btn btn-primary">Acheter</a></div>';
        });
      //ecouteur sur le bouton plus
      document.querySelector(".plus").addEventListener("click",function(){                
        element.value = qty ++;                
      }); 
      document.querySelector(".moins").addEventListener("click",function(){          
        element.value = qty --;
      });
         
        document.querySelector(".container").innerHTML = content + option;
      });

      function sendData(id) {
      var id = id;
      var order= {};

      $.ajax({
      url:"/order",
      type: "POST",
      data: order =  {
          "line_items": [
            {
              "variant_id": id,
              "quantity": 1
            }
          ],
      },
      dataType:"json",
      success:function(){
        alert('OK');
      },
      error: function(){
        alert('error saving order');
      }
    });
      };
    </script>
  </body>
</html>
